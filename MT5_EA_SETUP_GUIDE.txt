================================================================================
âœ… MT5 EXPERT ADVISOR (EA) SETUP & FIX GUIDE
================================================================================
Date: 2025-12-16
Version: 2.00

================================================================================
WHAT WAS WRONG
================================================================================

âŒ PROBLEM 1: API_URL hardcoded to localhost
   â””â”€ EA was trying to reach http://localhost:8000
   â””â”€ Your MT5 is on a DIFFERENT machine
   â””â”€ Signals never reached the backend

âŒ PROBLEM 2: API_KEY was placeholder
   â””â”€ Couldn't authenticate with backend
   â””â”€ All requests rejected (403 Forbidden)

âŒ PROBLEM 3: Polling interval too fast (1 second)
   â””â”€ Would spam API and cause timeouts
   â””â”€ Performance issues

âŒ PROBLEM 4: Poor error handling
   â””â”€ No logging of why orders fail
   â””â”€ Can't debug issues in MT5 Journal

âŒ PROBLEM 5: JSON parsing too simplistic
   â””â”€ Couldn't handle array of signals
   â””â”€ Only worked with single signal

âŒ PROBLEM 6: No validation
   â””â”€ Orders placed with invalid parameters
   â””â”€ MT5 rejected silently

================================================================================
WHAT WAS FIXED
================================================================================

âœ… FIX 1: API_URL now uses Render production URL
   â””â”€ API_URL = "https://ansorade-backend.onrender.com"
   â””â”€ Accessible from anywhere (including your MT5 machine)

âœ… FIX 2: API_KEY set to correct value
   â””â”€ API_KEY = "Mr.creative090"
   â””â”€ Matches backend configuration

âœ… FIX 3: Proper polling interval
   â””â”€ CHECK_INTERVAL = 5 seconds
   â””â”€ Fast enough for trading, slow enough to avoid spam

âœ… FIX 4: Comprehensive error handling & logging
   â””â”€ Shows in MT5 Journal exactly what happened
   â””â”€ Includes error codes and descriptions
   â””â”€ Easy to debug

âœ… FIX 5: Proper JSON parsing
   â””â”€ Handles single signal object
   â””â”€ Handles array of signals [...]
   â””â”€ Robust field extraction

âœ… FIX 6: Signal validation
   â””â”€ Checks symbol exists
   â””â”€ Checks volume is reasonable
   â””â”€ Checks TP > SL (for BUY) and TP < SL (for SELL)
   â””â”€ Checks sufficient balance
   â””â”€ Rejects invalid signals before trading

================================================================================
SETUP INSTRUCTIONS
================================================================================

STEP 1: Replace the EA file
   1. Close MT5 if open
   2. Copy the new CommunityTrader.mq5 to:
      C:\Users\User\AppData\Roaming\MetaTrader 5\MQL5\Experts\
   3. Restart MT5

STEP 2: Compile the EA
   1. In MT5, go to File â†’ Open Data Folder
   2. Navigate to MQL5 â†’ Experts
   3. Right-click on CommunityTrader.mq5 â†’ Compile
   4. Should show "0 error(s), 0 warning(s)" at bottom

STEP 3: Add EA to chart
   1. Open any chart (e.g., EURUSD, 1 Hour)
   2. Drag CommunityTrader EA onto the chart
   3. A settings dialog appears

STEP 4: Configure EA inputs
   
   In the EA inputs dialog, set:
   
   API_URL = https://ansorade-backend.onrender.com
   API_KEY = Mr.creative090
   CHECK_INTERVAL = 5
   RISK_PERCENT = 1.0
   
   Then click OK

STEP 5: Enable WebRequest (CRITICAL!)
   1. In MT5: Tools â†’ Options â†’ Expert Advisors
   2. Check âœ“ "Allow WebRequest for listed URL"
   3. Add to whitelist:
      https://ansorade-backend.onrender.com
   4. Click OK

STEP 6: Enable Live Trading (if not already enabled)
   1. In chart top toolbar, click the "AutoTrading" button
   2. It should turn GREEN (enabled)
   3. If it's disabled, EA won't place trades

STEP 7: Check MT5 Journal
   1. Go to View â†’ Toolbox
   2. Click "Experts" tab
   3. Should see initialization messages:
      âœ… COMMUNITY TRADER EA STARTED
      Server: FBS-Demo (or your server)
      Account: xxxxx
      Balance: $xxxxx
      API Configuration:
        URL: https://ansorade-backend.onrender.com
        API Key: Mr.creative090

================================================================================
TESTING (DO THIS FIRST!)
================================================================================

TEST 1: Verify EA is running
   Expected in Journal:
   âœ… COMMUNITY TRADER EA STARTED
   âœ… Check Interval: 5 seconds
   âœ“ Server: FBS-Demo
   âœ“ Account: 123456789
   âœ“ Balance: $10000

TEST 2: Check API connectivity
   Expected in Journal (every 5 seconds):
   ğŸ“¡ Checking for signals: https://ansorade-backend.onrender.com/api/signals/pending
   âœ… Got signals response: []
   (or if there are signals, shows them)

TEST 3: Send a test signal manually
   1. Use frontend or test script
   2. Send signal: EURUSD BUY @ 1.0850 TP 1.0880 SL 1.0820
   3. Within 5 seconds, EA should receive it
   4. Expected in Journal:
      ğŸ“ˆ NEW SIGNAL RECEIVED
      Action: BUY
      Symbol: EURUSD
      Confidence: 85%
      âœ… Signal validation passed!
      ğŸ”µ EXECUTING BUY ORDER
      âœ… BUY ORDER EXECUTED!
         Ticket: 123456789

TEST 4: Check order in MT5
   1. Go to Trade tab
   2. Should see new order:
      EURUSD BUY 0.01 @ 1.0850 TP 1.0880 SL 1.0820
   3. Right-click â†’ Details to see more info

TEST 5: Check confirmation sent to backend
   Expected in Journal:
   ğŸ“¡ Sending POST to: https://ansorade-backend.onrender.com/api/trades/confirm
   âœ… API Response: {"message": "Trade confirmed"}

================================================================================
TROUBLESHOOTING
================================================================================

ISSUE: "EA won't place trades"
SOLUTION:
   1. Check AutoTrading button is GREEN
   2. Check "Allow WebRequest" is enabled
   3. Check WebRequest URL is whitelisted
   4. Restart MT5

ISSUE: "â„¹ï¸ No pending signals" keeps repeating
SOLUTION:
   1. Verify signals are being sent from Anso-Vision
   2. Check https://ansorade-backend.onrender.com/health
   3. Check MT5 community backend logs on Render

ISSUE: "âŒ WebRequest failed. Code: -2" (Cannot connect)
SOLUTION:
   1. Check your internet connection
   2. Try pinging: ping ansorade-backend.onrender.com
   3. Check firewall isn't blocking MT5
   4. Try using IP address instead of domain

ISSUE: "âŒ API Error: 403 (Forbidden - Invalid API Key)"
SOLUTION:
   1. Check API_KEY input is: Mr.creative090
   2. Check backend is using same key
   3. Don't add extra spaces or quotes

ISSUE: "âŒ BUY FAILED! Error Code: 10020"
SOLUTION:
   1. Insufficient balance - deposit more money
   2. Or reduce order volume
   3. Check TP > SL (for BUY)

ISSUE: "âŒ BUY FAILED! Error Code: 10022"
SOLUTION:
   1. Market is closed
   2. Symbol not tradable at this time
   3. Try during market hours

ISSUE: "âŒ Symbol not found: EURUSD"
SOLUTION:
   1. Add EURUSD to Market Watch
   2. Or use correct symbol (EURCHF, EURJPY, etc.)

================================================================================
JOURNAL EXAMPLES
================================================================================

GOOD LOG (Orders placed successfully):
---
âœ… COMMUNITY TRADER EA STARTED
Server: FBS-Demo
Account: 123456
Balance: $10000

ğŸ“¡ Checking for signals: https://ansorade-backend.onrender.com/api/signals/pending
âœ… Got signals response: [{"id":1,"action":"BUY"...}]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ˆ NEW SIGNAL RECEIVED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Action: BUY
Symbol: EURUSD
Volume: 0.01
TP: 1.0880
SL: 1.0820
Confidence: 85.0%

âœ… Signal validation passed!

ğŸ”µ EXECUTING BUY ORDER
Symbol: EURUSD
Volume: 0.01
Entry: MARKET
TP: 1.0880
SL: 1.0820

âœ… BUY ORDER EXECUTED!
   Ticket: 555123456
   Price: 1.08501
   Volume: 0.01

ğŸ“¡ Sending POST to: https://ansorade-backend.onrender.com/api/trades/confirm
âœ… API Response: {"message": "Trade confirmed"}
---

BAD LOG (Check this):
---
âŒ WebRequest failed. Code: -2
   Make sure EA has WebRequest permissions!
   Check Tools â†’ Options â†’ Expert Advisors â†’ Allow WebRequest
---

FIX: Enable WebRequest in Tools â†’ Options â†’ Expert Advisors

================================================================================
IMPORTANT NOTES
================================================================================

âœ… This EA polls every 5 seconds
   â””â”€ Trades will execute within 5 seconds of signal
   â””â”€ Adjust CHECK_INTERVAL if needed

âœ… Uses MARKET orders
   â””â”€ Executes at ASK (BUY) or BID (SELL)
   â””â”€ Sets SL and TP immediately

âœ… Each signal placed as separate trade
   â””â”€ If you send 3 signals, 3 trades will open
   â””â”€ Manage them individually in MT5

âœ… Account updates sent every 10 seconds
   â””â”€ Balance, equity, profit synchronized to backend

âœ… All activity logged in Journal
   â””â”€ Great for debugging
   â””â”€ Save logs for reference

================================================================================
